/*
@title: DoNotTouch
@author: Yogesh Kushwaha
Instructions:
WASD to control your player
*/


const player = "p";
const wall = "o";
const background = "i";

let score = 0;
let y1 = 0;
let y2 = 0;
let y3 = 0;
const music = tune`
179.64071856287424,
179.64071856287424: g5~179.64071856287424 + d5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + d5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + d5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + c5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + c5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + e5/179.64071856287424,
179.64071856287424: g5~179.64071856287424 + e5/179.64071856287424,
179.64071856287424: a5~179.64071856287424,
179.64071856287424: a5~179.64071856287424,
179.64071856287424: a5~179.64071856287424,
179.64071856287424: a5~179.64071856287424,
179.64071856287424: a5~179.64071856287424,
179.64071856287424: g5~179.64071856287424,
179.64071856287424: g5~179.64071856287424,
179.64071856287424: d5/179.64071856287424 + g5~179.64071856287424,
179.64071856287424: g5~179.64071856287424 + f5~179.64071856287424 + e5~179.64071856287424 + d5~179.64071856287424,
179.64071856287424: g4-179.64071856287424,
179.64071856287424: f4-179.64071856287424,
179.64071856287424: g4-179.64071856287424,
179.64071856287424: d5~179.64071856287424,
179.64071856287424: d5~179.64071856287424 + e5~179.64071856287424,
179.64071856287424: e5~179.64071856287424,
179.64071856287424: e5~179.64071856287424 + d5~179.64071856287424 + c5~179.64071856287424,
179.64071856287424: c5~179.64071856287424 + b4~179.64071856287424,
179.64071856287424: g4-179.64071856287424 + c5^179.64071856287424,
179.64071856287424: f4-179.64071856287424 + d5^179.64071856287424 + c5^179.64071856287424 + b4^179.64071856287424,
179.64071856287424: g4-179.64071856287424 + c5^179.64071856287424,
179.64071856287424: a4~179.64071856287424,
179.64071856287424: a4~179.64071856287424 + b4~179.64071856287424 + c5~179.64071856287424,
179.64071856287424: c5~179.64071856287424 + b4~179.64071856287424 + a4~179.64071856287424 + g4~179.64071856287424,
179.64071856287424: g4~179.64071856287424 + f4~179.64071856287424`
const hit = tune`
30: b4-30 + c5-30 + a4-30,
30: c5-30 + b4-30 + a4-30,
30: c5-30 + a4-30 + b4-30,
30: c5-30 + a4-30 + b4-30,
30: c5-30 + a4-30 + b4-30,
30: c5-30 + a4-30 + b4-30,
30: c5-30 + b4-30 + a4-30,
30: a4-30 + b4-30 + c5-30,
30: a4-30 + c5-30 + b4-30,
30: a4-30 + b4-30 + c5-30,
30: a4-30 + c5-30 + b4-30,
30: a4-30 + b4-30 + c5-30,
600`
const goalSound = tune`
162.16216216216216,
81.08108108108108: e5~81.08108108108108,
81.08108108108108: d5~81.08108108108108,
81.08108108108108: d5~81.08108108108108,
81.08108108108108: c5~81.08108108108108,
81.08108108108108: c5~81.08108108108108,
81.08108108108108: c5~81.08108108108108,
81.08108108108108: b4~81.08108108108108,
81.08108108108108: b4~81.08108108108108,
81.08108108108108: a4~81.08108108108108,
81.08108108108108: g4~81.08108108108108,
81.08108108108108: g4~81.08108108108108,
81.08108108108108: f4~81.08108108108108,
81.08108108108108: f4~81.08108108108108,
81.08108108108108: e4~81.08108108108108,
81.08108108108108: e4~81.08108108108108,
81.08108108108108: d4~81.08108108108108,
81.08108108108108: d4~81.08108108108108,
81.08108108108108: c4~81.08108108108108,
81.08108108108108: c4~81.08108108108108,
891.8918918918919`

function updateScore() {
  clearText()
  addText(`Score:${score}`, {
    x: 1, 
    y: 4, 
    color: color`2`
  })
}

setLegend(
  [player,bitmap`
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333
3333333333333333`],
  [wall,bitmap`
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555
5555555555555555`],
  [background,bitmap`
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222
2222222222222222`]
);

setBackground(background)
const level = map`
.................
p................
.................
.................`
setMap(level)

setSolids([ player, ]);

setPushables({
  [player]: []
});

updateScore()

playTune(music, Infinity)

// START - PLAYER MOVEMENT CONTROLS

onInput("s", () => {
  getFirst(player).y += 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});

onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("a", () => {
  getFirst(player).x -= 1;
});

//collision
setInterval(() => {
  if (tilesWith(player, wall).length > 0) {
    playTune(hit)
    setMap(level)
    score = 0
    updateScore()
  }
  //wall despawning
  getAll(wall).forEach((wallObj) => {
    if (wallObj.x === 0) {
      wallObj.remove()
    }
    })
  //player scoring
  getAll(player).forEach((playerObj) => {
    if (playerObj.x === 16) {
      playTune(goalSound)
      score = score + 1
      updateScore()
      setMap(level)
    }
  })
})

//wall movement
setInterval(() => {
  getAll(wall).forEach((wallObj) => {
    wallObj.x -= 1
  })
}, 300)

//wall spawning
setInterval(() => {
  let spawn1 = Math.random();
  let spawn2 = Math.random();
  let spawn3 = Math.random();

  if (spawn1 < 0.2) {
    y1 = 0;
  }
  else if (spawn1 < 0.4) {
    y1 = 1;
  }
  else if (spawn1 < 0.6) {
    y1 = 2;
  }
  
  else {
    y1 = 4;
  }
  
  if (spawn2 < 0.2) {
    y2 = 0;
  }
  else if (spawn2 < 0.4) {
    y2 = 1;
  }
  else if (spawn2 < 0.6) {
    y2 = 2;
  }
  else if (spawn2 < 0.8) {
    y2 = 3;
  }
  else {
    y2 = 4;
  }

  if (spawn3 < 0.2) {
    y3 = 0;
  }
  else if (spawn3 < 0.4) {
    y3 = 1;
  }
  else if (spawn3 < 0.6) {
    y3 = 2;
  }
  else if (spawn3 < 0.8) {
    y3 = 3;
  }
  else {
    y3 = 4;
  }
  
  addSprite(16, y1, wall);
  addSprite(16, y2, wall);
  addSprite(16, y3, wall);
}, 900)
